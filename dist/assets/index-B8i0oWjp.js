import{r as l,H as V,ag as Z,ah as ee,q as P,ai as te,aj as re,X as ne,E as oe,M as B,k as H,a as ae,ak as ce}from"./index-BA7W61Th.js";var A=function(){return A=Object.assign||function(e){for(var n,a=1,o=arguments.length;a<o;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},A.apply(this,arguments)};function ie(e,n,a,o){return new(a||(a=Promise))(function(t,c){function i(d){try{u(o.next(d))}catch(r){c(r)}}function f(d){try{u(o.throw(d))}catch(r){c(r)}}function u(d){var r;d.done?t(d.value):(r=d.value,r instanceof a?r:new a(function(p){p(r)})).then(i,f)}u((o=o.apply(e,[])).next())})}function ue(e,n){var a,o,t,c={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=f(0),i.throw=f(1),i.return=f(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function f(u){return function(d){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,r[0]&&(c=0)),c;)try{if(a=1,o&&(t=2&r[0]?o.return:r[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,r[1])).done)return t;switch(o=0,t&&(r=[2&r[0],t.value]),r[0]){case 0:case 1:t=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,o=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(t=c.trys,!((t=t.length>0&&t[t.length-1])||r[0]!==6&&r[0]!==2)){c=0;continue}if(r[0]===3&&(!t||r[1]>t[0]&&r[1]<t[3])){c.label=r[1];break}if(r[0]===6&&c.label<t[1]){c.label=t[1],t=r;break}if(t&&c.label<t[2]){c.label=t[2],c.ops.push(r);break}t[2]&&c.ops.pop(),c.trys.pop();continue}r=n.call(e,c)}catch(p){r=[6,p],o=0}finally{a=t=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([u,d])}}}function L(e,n,a){if(a||arguments.length===2)for(var o,t=0,c=n.length;t<c;t++)!o&&t in n||(o||(o=Array.prototype.slice.call(n,0,t)),o[t]=n[t]);return e.concat(o||Array.prototype.slice.call(n))}var W,Y={exports:{}},K={},q,k=(q||(q=1,Y.exports=function(){if(W)return K;W=1;var e=Z,n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,t=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function i(f,u,d){var r,p={},x=null,O=null;for(r in d!==void 0&&(x=""+d),u.key!==void 0&&(x=""+u.key),u.ref!==void 0&&(O=u.ref),u)o.call(u,r)&&!c.hasOwnProperty(r)&&(p[r]=u[r]);if(f&&f.defaultProps)for(r in u=f.defaultProps)p[r]===void 0&&(p[r]=u[r]);return{$$typeof:n,type:f,key:x,ref:O,props:p,_owner:t.current}}return K.Fragment=a,K.jsx=i,K.jsxs=i,K}()),Y.exports);function F(e){return e==null}function J(e){return Array.isArray(e)}function D(e){return typeof e=="function"}function Q(e){return{set:function(n,a){return e.setAttribute(n,a),Q(e)}}}function z(e){var n;return e===void 0&&(e=100),new Promise(function(a,o){n=setTimeout(function(){a(),F(n)||clearTimeout(n)},e)})}function X(e,n){return(J(e)?e:F(e)?[]:[e]).some(function(a){return o=a,Object.prototype.toString.call(o)==="[object RegExp]"?a.test(n):n===a;var o})}var se=l.createContext({active:!1,refresh:function(){},destroy:function(){return Promise.resolve()},destroyAll:function(){return Promise.resolve()},destroyOther:function(){return Promise.resolve()},getCacheNodes:function(){return[]}}),le=l.memo(function(e){var n=e.children,a=e.active,o=e.refresh,t=e.destroy,c=e.destroyAll,i=e.destroyOther,f=e.getCacheNodes,u=l.useMemo(function(){return{active:a,refresh:o,destroy:t,destroyAll:c,destroyOther:i,getCacheNodes:f}},[a,o,t,c,i,f]);return k.jsx(se.Provider,{value:u,children:n})}),fe=l.memo(function(e){var n=this,a=e.errorElement,o=a===void 0?l.Fragment:a,t=e.cacheNodeClassName,c=e.children,i=e.cacheKey,f=e.isCached,u=e.active,d=e.renderCount,r=e.destroy,p=e.transition,x=e.duration,O=e.containerDivRef,R=l.useRef(!1),N=f(i);R.current=R.current||u;var w=l.useMemo(function(){var y=document.createElement("div");return Q(y).set("data-cache-key",i).set("data-cached",N.valueOf().toString()).set("style","height: 100%").set("data-render-count",d.toString()),y.className=t,y},[d,t]),C=O.current;if(p)ie(n,void 0,void 0,function(){var y;return ue(this,function(s){switch(s.label){case 0:return u&&C?(y=S(C),[4,z(x-40)]):[3,2];case 1:return s.sent(),j(y),C.contains(w)?[2]:(_(C,w),[3,4]);case 2:return N?[3,4]:[4,z(x)];case 3:s.sent(),r(i),s.label=4;case 4:return[2]}})});else if(u&&C){if(j(S(C)),C.contains(w))return;_(C,w)}else N||r(i);function S(y){var s=Array.from(y.children).filter(function(E){return E.classList.contains("active")&&E.getAttribute("data-cache-key")!==i});return s.forEach(function(E){E.classList.remove("active"),E.classList.add("inactive")}),s}function _(y,s){j(Array.from(y.children)),y.appendChild(s),s.classList.remove("inactive"),s.classList.add("active")}function j(y){y.forEach(function(s){s.remove()})}return R.current?V.createPortal(k.jsx(o,{children:c}),w,i):null},function(e,n){return e.active===n.active&&e.renderCount===n.renderCount});function de(){return l.useRef()}function he(e){var n=e.activeCacheKey,a=e.max,o=a===void 0?10:a,t=e.exclude,c=e.include,i=e.onBeforeActive,f=e.customContainerRef,u=e.cacheNodeClassName,d=u===void 0?"cache-component":u,r=e.containerClassName,p=r===void 0?"keep-alive-render":r,x=e.errorElement,O=e.transition,R=O!==void 0&&O,N=e.duration,w=N===void 0?200:N,C=e.children,S=e.aliveRef,_=f||l.useRef(null),j=l.useState([]),y=j[0],s=j[1],E=l.useCallback(function(v){return c?X(c,v):!t||!X(t,v)},[t,c]);l.useLayoutEffect(function(){var v;F(n)||(v=function(){s(function(h){var b=Date.now();if(h.find(function(g){return g.cacheKey===n}))return h.map(function(g){return g.cacheKey===n?(D(i)&&i(n),A(A({},g),{ele:C,lastActiveTime:b})):g});if(D(i)&&i(n),h.length>o){var m=h.reduce(function(g,T){return g.lastActiveTime<T.lastActiveTime?g:T});h.splice(h.indexOf(m),1)}return L(L([],h,!0),[{cacheKey:n,lastActiveTime:b,ele:C,renderCount:0}],!1)})},D(l.startTransition)?l.startTransition(v):v())},[n]);var M=l.useCallback(function(v){s(function(h){var b=v||n;return h.map(function(m){return m.cacheKey===b?A(A({},m),{renderCount:m.renderCount+1}):m})})},[s,n]),I=l.useCallback(function(v){var h=v||n,b=J(h)?h:[h];return new Promise(function(m){setTimeout(function(){s(function(g){return L([],g.filter(function(T){return!b.includes(T.cacheKey)}),!0)}),m()},0)})},[s,n]),G=l.useCallback(function(){return new Promise(function(v){setTimeout(function(){s([]),v()},0)})},[s]),U=l.useCallback(function(v){var h=v||n;return new Promise(function(b){setTimeout(function(){s(function(m){return L([],m.filter(function(g){return g.cacheKey===h}),!0)}),b()},0)})},[n,s]),$=l.useCallback(function(){return y},[y]);return l.useImperativeHandle(S,function(){return{refresh:M,destroy:I,destroyAll:G,destroyOther:U,getCacheNodes:$}}),k.jsxs(l.Fragment,{children:[k.jsx("div",{ref:_,className:p,style:{height:"100%"}}),y.map(function(v){var h=v.cacheKey,b=v.ele,m=v.renderCount;return k.jsx(le,{active:n===h,refresh:M,destroy:I,destroyAll:G,destroyOther:U,getCacheNodes:$,children:k.jsx(fe,{destroy:I,isCached:E,transition:R,duration:w,renderCount:m,containerDivRef:_,errorElement:x,active:n===h,cacheNodeClassName:d,cacheKey:h,children:b})},"".concat(h,"-").concat(m))})]})}const ve=()=>{const e=ce();return(e.pathname+e.search).slice(1).split("/").join("_")},me=l.memo(({closePadding:e})=>{const n=ee(),a=de(),o=P(te),t=P(re),c=P(ne),i=ve(),f=P(oe),u=f.page.animate?f.page.animateMode:"";return B(()=>{!a.current||!o||a.current.destroy(o)},[o]),B(()=>{var d;(d=a.current)==null||d.refresh()},[c]),H.jsx("div",{className:ae("h-full flex-grow bg-layout",{"p-16px":!e}),children:H.jsx(he,{activeCacheKey:i,aliveRef:a,cacheNodeClassName:c?u:"",include:t,children:n})})});export{me as G};
