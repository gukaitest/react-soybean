import{r as c,aJ as h,f as w,aK as C,l as T}from"./index-BA7W61Th.js";import{_}from"./tslib.es6-CwN1OpI9.js";import{u as D}from"./use-loading-BnRq-ISL.js";import"./subscribeFocus-C0kbgqSh.js";import"./_baseGetTag-BMkVdEYU.js";import{R as E}from"./form-BSzh_rzb.js";var g=function(t){if(!t)return 0;var e=C(t).valueOf()-Date.now();return e<0?0:e},b=function(t){return{days:Math.floor(t/864e5),hours:Math.floor(t/36e5)%24,minutes:Math.floor(t/6e4)%60,seconds:Math.floor(t/1e3)%60,milliseconds:Math.floor(t)%1e3}},R=function(t){t===void 0&&(t={});var e=t||{},r=e.leftTime,o=e.targetDate,u=e.interval,i=u===void 0?1e3:u,s=e.onEnd,l=c.useMemo(function(){return h(r)&&r>0?Date.now()+r:void 0},[r]),a="leftTime"in t?l:o,m=_(c.useState(function(){return g(a)}),2),n=m[0],f=m[1],d=w(s);c.useEffect(function(){if(!a){f(0);return}f(g(a));var p=setInterval(function(){var v,L=g(a);f(L),L===0&&(clearInterval(p),(v=d.current)===null||v===void 0||v.call(d))},i);return function(){return clearInterval(p)}},[a,i]);var M=c.useMemo(function(){return b(n)},[n]);return[n,M]};function x(t){const[e,r]=c.useState(0),[o]=R({targetDate:e}),u=Math.round(o/1e3),i=o>0;function s(a=t){r(Date.now()+a*1e3)}function l(){r(0)}return{count:u,isCounting:i,start:s,stop:l}}function S(){const{endLoading:t,loading:e,startLoading:r}=D(),{count:o,isCounting:u,start:i}=x(10),{t:s}=T(),l=c.useMemo(()=>{let n=s("page.login.codeLogin.getCode");const f=s("page.login.codeLogin.reGetCode",{time:o});return e&&(n=""),u&&(n=f),n},[o]);function a(n){return!(n.trim()===""||!E.test(n))}async function m(n){!a(n)||e||(r(),await new Promise(d=>{setTimeout(d,500)}),i(),t())}return{getCaptcha:m,isCounting:u,label:l,loading:e}}export{S as u};
